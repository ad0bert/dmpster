@(dumps: List[Dump], allTags: Seq[Tag]) 
@import helper._ 

@splitBucketName(bucketName: String) = @{
	bucketName.split("!") match { case Array(x1, x2) => (x1, x2) } 
}

@addTag(taggable: Taggable) = {
	<a href=# class="tag add">add a tag...</a>
	<input type="text" 
		class="tag-input"
		baseurl="dmpster/@taggable.url/@taggable.id/addTag/" 
		list="tags" 
		placeholder="add a Tag"
		style="display:none">
	</input>
}

@main {

	<datalist id="tags">
	  @allTags.map{ t => 
	    <option>@t.name</option>
	  }
	</datalist>

	@dumps.groupBy(_.bucket.name).map { case(bucketName, dmps) =>
	<article>
		<h1>
			@defining(splitBucketName(bucketName)) { split =>
				@split._1<wbr>!@split._2
			}
			@listTags(dmps.head.bucket)
			@addTag(dmps.head.bucket)
		</h1>
	
		@dmps.map { dump =>
		<section class="@if(dump.isNew) { new } dmp">
			<h1>
				<a href="@routes.Assets.at("dmps/" + dump.filename)"><img src="@routes.Assets.at("images/download.svg")"></img></a>
				<a href="dmpster/dmp/@dump.id/details">@dump.filename</a>
			</h1>
			
			@listTags(dump)
			@addTag(dump)
			
			<time>1 day old</time>
		</section>
		}
	</article>
	}
	
<script src="@routes.Assets.at("javascripts/tagging.js")"></script>
}
